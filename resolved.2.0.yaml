openapi: 3.0.3
info:
  title: Individuals Disclosures (MTD)
  description: "The following group of endpoints is stateful in the Sandbox:\n* [Disclosures](#tag/Disclosures)\n\
    \n# Send fraud prevention data\nHMRC monitors transactions to help protect your\
    \ customers' confidential data from criminals and fraudsters. \n\n<div class=\"\
    govuk-warning-text warning-icon-fix\">\n  <span class=\"govuk-warning-text__icon\
    \ warning-icon-ui-fix\" aria-hidden=\"true\">!</span>\n  <strong class=\"govuk-warning-text__text\"\
    >\n    <span class=\"govuk-warning-text__assistive\">Warning</span>\n    You are\
    \ required by law to submit header data for this API. This includes all associated\
    \ APIs and endpoints.\n  </strong>\n</div>\n\n[Check the data you need to send](/guides/fraud-prevention/).\
    \ You can also use the [Test API](/api-documentation/docs/api/service/txm-fph-validator-api/1.0)\
    \ during initial development and as part of your quality assurance checks.\n\n\
    # Mapping APIs to Self Assessment tax return forms\nSome parameters in this API\
    \ map to box numbers in one or more Self Assessment tax return forms. To learn\
    \ more and to download this mapping information as a CSV file, go to [income-tax-mtd-changelog/mapping](https://github.com/hmrc/income-tax-mtd-changelog?tab=readme-ov-file#mapping-apis-to-self-assessment-tax-return-forms)\
    \ on GitHub.\n\n# Changelog\nYou can find the changelog in the [income-tax-mtd-changelog](https://github.com/hmrc/income-tax-mtd-changelog/#readme)\
    \ on GitHub.\n\n# Support\n* Direct reports of bugs or errors in Production or\
    \ Sandbox code, or queries about HMRC business functionality (such as how a specific\
    \ field is used by HMRC or why it is needed) to the [Software Development Support\
    \ Team (SDST)](https://developer.service.hmrc.gov.uk/developer/support).\n* Send\
    \ queries or feedback related to the design of the APIs (including recommended\
    \ changes) using the [income-tax-mtd-changelog](https://github.com/hmrc/income-tax-mtd-changelog/issues)\
    \ GitHub page.\n* <a href=\"/contact/report-technical-problem?newTab=true&service=api-documentation-frontend\"\
    \ target=\"_blank\">Is this page not working properly? (opens in new tab)</a>\n"
  version: "2.0"
servers:
- url: https://test-api.service.hmrc.gov.uk
  description: Sandbox
- url: https://api.service.hmrc.gov.uk
  description: Production
paths:
  /individuals/disclosures/marriage-allowance/{nino}:
    post:
      tags:
      - Marriage Allowance
      summary: Create Marriage Allowance
      description: "This endpoint allows the customer to transfer up to Â£1,260 of\
        \ their personal allowance to their spouse or civil \npartner. A National\
        \ Insurance Number must be provided.\n\n### Test data\nScenario simulation\
        \ using Gov-Test-Scenario headers is only available in the sandbox environment.\n\
        \n| Header Value (Gov-Test-Scenario)      | Scenario                     \
        \                                                                      |\n\
        |---------------------------------------|----------------------------------------------------------------------------------------------------|\n\
        | N/A - DEFAULT                         | Simulates success response.    \
        \                                                                    |\n|\
        \ DECEASED_RECIPIENT                    | Simulates the scenario in which\
        \ the supplied spouse or civil partner has been flagged as deceased. |\n|\
        \ CLAIM_ALREADY_EXISTS                  | Simulates the scenario in which\
        \ a Marriage Allowance claim already exists for the supplied NINO.   |\n|\
        \ INVALID_REQUEST                       | Simulates the scenario in which\
        \ a request cannot be made as the current NINO supplied is invalid.  |\n"
      parameters:
      - name: nino
        in: path
        description: |
          National Insurance number, in the format `AA999999A`
        required: true
        schema:
          type: string
          example: TC663795B
      - name: Accept
        in: header
        description: |
          Specifies the response format and the version of the API to be used.
        required: true
        schema:
          type: string
          enum:
          - application/vnd.hmrc.2.0+json
      - name: Authorization
        in: header
        description: |
          An OAuth 2.0 Bearer Token with the *write:self-assessment* scope.
        required: true
        schema:
          type: string
          example: Bearer bb7fed3fe10dd235a2ccda3d50fb
      - name: Content-Type
        in: header
        description: |
          Specifies the format of the request body, which must be JSON.
        required: true
        schema:
          type: string
          enum:
          - application/json
      - name: Gov-Test-Scenario
        in: header
        description: |
          Only in sandbox environment. See Test Data table for all header values.
        required: false
        schema:
          type: string
          example: "-"
      requestBody:
        content:
          application/json:
            schema:
              title: Create Marriage Allowance Request
              required:
              - spouseOrCivilPartnerNino
              - spouseOrCivilPartnerSurname
              type: object
              properties:
                spouseOrCivilPartnerNino:
                  type: string
                  description: Your spouse or civil partner's National Insurance number.
                  format: "^((?!(BG|GB|KN|NK|NT|TN|ZZ)|(D|F|I|Q|U|V)[A-Z]|[A-Z](D|F|I|O|Q|U|V))[A-Z]{2})[0-9]{6}[A-D]$"
                  example: AA999999A
                spouseOrCivilPartnerFirstName:
                  maxLength: 35
                  minLength: 1
                  type: string
                  description: Your spouse or civil partner's first name.
                  example: John
                spouseOrCivilPartnerSurname:
                  maxLength: 35
                  minLength: 1
                  type: string
                  description: Your spouse or civil partner's surname.
                  example: Smith
                spouseOrCivilPartnerDateOfBirth:
                  type: string
                  description: The date of birth of your spouse or civil partner in
                    the format YYYY-MM-DD.
                  format: "[0-9]{4}-[0-9]{2}-[0-9]{2}$"
                  example: 1998-04-06
              description: Create Marriage Allowance Request
            examples:
              Request:
                value:
                  $ref: ./examples/marriageAllowance/create_marriageAllowance_request.json
      responses:
        "201":
          description: Success
          headers:
            X-CorrelationId:
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              required: true
              schema:
                type: string
                example: c75f40a6-a3df-4429-a697-471eeec46435
            Deprecation:
              description: |
                The deprecation date/time for this endpoint.
              required: false
              schema:
                type: string
                example: "Sun, 01 Jan 2023 23:59:59 GMT"
            Sunset:
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              required: false
              schema:
                type: string
                example: "Sun, 02 Jul 2023 23:59:59 GMT"
            Link:
              description: |
                URL of the documentation for the API.
              required: false
              schema:
                type: string
                example: https://developer.service.hmrc.gov.uk/api-documentation/docs/api/service/individuals-disclosures-api
        "400":
          description: Bad request
          headers:
            X-CorrelationId:
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              required: true
              schema:
                type: string
                example: c75f40a6-a3df-4429-a697-471eeec46435
            Deprecation:
              description: |
                The deprecation date/time for this endpoint.
              required: false
              schema:
                type: string
                example: "Sun, 01 Jan 2023 23:59:59 GMT"
            Sunset:
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              required: false
              schema:
                type: string
                example: "Sun, 02 Jul 2023 23:59:59 GMT"
            Link:
              description: |
                URL of the documentation for the API.
              required: false
              schema:
                type: string
                example: https://developer.service.hmrc.gov.uk/api-documentation/docs/api/service/individuals-disclosures-api
          content:
            application/json:
              schema:
                required:
                - code
                type: object
                properties:
                  code:
                    type: string
                    description: The error code
                  message:
                    type: string
                    description: The error message
                description: Error Response
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied NINO field is not valid.
                  value:
                    code: FORMAT_NINO
                    message: The provided NINO is invalid
                FORMAT_SPOUSE_OR_CIVIL_PARTNERS_FIRST_NAME:
                  description: |
                    The format of your spouse or civil partner's first name is not valid.
                  value:
                    code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_FIRST_NAME
                    message: The provided spouse or civil partner's first name is
                      invalid
                FORMAT_SPOUSE_OR_CIVIL_PARTNERS_SURNAME:
                  description: |
                    The format of your spouse or civil partner's surname name is not valid.
                  value:
                    code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_SURNAME
                    message: The provided spouse or civil partner's surname is invalid
                FORMAT_SPOUSE_OR_CIVIL_PARTNERS_NINO:
                  description: |
                    The format of your spouse or civil partner's National Insurance Number is not valid.
                  value:
                    code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_NINO
                    message: The provided spouse or civil partner's National Insurance
                      Number is invalid
                FORMAT_SPOUSE_OR_CIVIL_PARTNERS_DATE_OF_BIRTH:
                  description: |
                    The format of the supplied spouse or civil partner's date of birth is not valid.
                  value:
                    code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_DATE_OF_BIRTH
                    message: The provided spouse or civil partner's date of birth
                      date is invalid
                RULE_DECEASED_RECIPIENT:
                  description: |
                    The supplied spouse or civil partner is invalid because they are deceased.
                  value:
                    code: RULE_DECEASED_RECIPIENT
                    message: The provided spouse or civil partner is deceased
                RULE_ACTIVE_MARRIAGE_ALLOWANCE_CLAIM:
                  description: |
                    The request cannot be made as there is an existing Marriage Allowance claim.
                  value:
                    code: RULE_ACTIVE_MARRIAGE_ALLOWANCE_CLAIM
                    message: Marriage Allowance has already been transferred to a
                      spouse or civil partner
                RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED:
                  description: |
                    An empty or non-matching body was submitted.
                  value:
                    code: RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED
                    message: An empty or non-matching body was submitted
                RULE_INVALID_REQUEST:
                  description: |
                    The request cannot be made as the current NINO supplied is invalid.
                  value:
                    code: RULE_INVALID_REQUEST
                    message: The NINO supplied is invalid
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: "The request did not match any available Sandbox data.\
                    \ Check that the supplied Gov-Test-Scenario is correct for \n\
                    this endpoint version. This error will only be returned in the\
                    \ Sandbox environment.\n"
                  value:
                    code: RULE_INCORRECT_GOV_TEST_SCENARIO
                    message: The supplied Gov-Test-Scenario is not valid
        "403":
          description: Forbidden
          headers:
            X-CorrelationId:
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              required: true
              schema:
                type: string
                example: c75f40a6-a3df-4429-a697-471eeec46435
            Deprecation:
              description: |
                The deprecation date/time for this endpoint.
              required: false
              schema:
                type: string
                example: "Sun, 01 Jan 2023 23:59:59 GMT"
            Sunset:
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              required: false
              schema:
                type: string
                example: "Sun, 02 Jul 2023 23:59:59 GMT"
            Link:
              description: |
                URL of the documentation for the API.
              required: false
              schema:
                type: string
                example: https://developer.service.hmrc.gov.uk/api-documentation/docs/api/service/individuals-disclosures-api
          content:
            application/json:
              schema:
                required:
                - code
                type: object
                properties:
                  code:
                    type: string
                    description: The error code
                  message:
                    type: string
                    description: The error message
                description: Error Response
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    The client and/or agent is not authorised. This is normally because: the client is not subscribed to MTD, the agent is not subscribed to Agent Services, or the client has not authorised the agent to act on their behalf.
                  value:
                    code: CLIENT_OR_AGENT_NOT_AUTHORISED
                    message: The client and/or agent is not authorised
      security:
      - User-Restricted:
        - write:self-assessment
  /individuals/disclosures/{nino}/{taxYear}:
    get:
      summary: Retrieve Disclosures
      security:
      - User-Restricted:
        - read:self-assessment
    put:
      summary: Create and Amend Disclosures
      security:
      - User-Restricted:
        - write:self-assessment
    delete:
      summary: Delete Disclosures
      security:
      - User-Restricted:
        - write:self-assessment
components:
  schemas:
    create_marriageAllowance_request:
      title: Create Marriage Allowance Request
      required:
      - spouseOrCivilPartnerNino
      - spouseOrCivilPartnerSurname
      type: object
      properties:
        spouseOrCivilPartnerNino:
          type: string
          description: Your spouse or civil partner's National Insurance number.
          format: "^((?!(BG|GB|KN|NK|NT|TN|ZZ)|(D|F|I|Q|U|V)[A-Z]|[A-Z](D|F|I|O|Q|U|V))[A-Z]{2})[0-9]{6}[A-D]$"
          example: AA999999A
        spouseOrCivilPartnerFirstName:
          maxLength: 35
          minLength: 1
          type: string
          description: Your spouse or civil partner's first name.
          example: John
        spouseOrCivilPartnerSurname:
          maxLength: 35
          minLength: 1
          type: string
          description: Your spouse or civil partner's surname.
          example: Smith
        spouseOrCivilPartnerDateOfBirth:
          type: string
          description: The date of birth of your spouse or civil partner in the format
            YYYY-MM-DD.
          format: "[0-9]{4}-[0-9]{2}-[0-9]{2}$"
          example: 1998-04-06
      description: Create Marriage Allowance Request
    error-response:
      required:
      - code
      type: object
      properties:
        code:
          type: string
          description: The error code
        message:
          type: string
          description: The error message
      description: Error Response
  parameters:
    nino:
      name: nino
      in: path
      description: |
        National Insurance number, in the format `AA999999A`
      required: true
      schema:
        type: string
        example: TC663795B
    acceptJson:
      name: Accept
      in: header
      description: |
        Specifies the response format and the version of the API to be used.
      required: true
      schema:
        type: string
        enum:
        - application/vnd.hmrc.2.0+json
    authorizationWriteScopeHeader:
      name: Authorization
      in: header
      description: |
        An OAuth 2.0 Bearer Token with the *write:self-assessment* scope.
      required: true
      schema:
        type: string
        example: Bearer bb7fed3fe10dd235a2ccda3d50fb
    contentTypeJson:
      name: Content-Type
      in: header
      description: |
        Specifies the format of the request body, which must be JSON.
      required: true
      schema:
        type: string
        enum:
        - application/json
    testScenarioHeader:
      name: Gov-Test-Scenario
      in: header
      description: |
        Only in sandbox environment. See Test Data table for all header values.
      required: false
      schema:
        type: string
        example: "-"
  examples:
    formatNino:
      description: |
        The format of the supplied NINO field is not valid.
      value:
        code: FORMAT_NINO
        message: The provided NINO is invalid
    formatSpouseOrCivilPartnersFirstName:
      description: |
        The format of your spouse or civil partner's first name is not valid.
      value:
        code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_FIRST_NAME
        message: The provided spouse or civil partner's first name is invalid
    formatSpouseOrCivilPartnersSurname:
      description: |
        The format of your spouse or civil partner's surname name is not valid.
      value:
        code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_SURNAME
        message: The provided spouse or civil partner's surname is invalid
    formatSpouseOrCivilPartnersNino:
      description: |
        The format of your spouse or civil partner's National Insurance Number is not valid.
      value:
        code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_NINO
        message: The provided spouse or civil partner's National Insurance Number
          is invalid
    formatSpouseOrCivilPartnersDateOfBirth:
      description: |
        The format of the supplied spouse or civil partner's date of birth is not valid.
      value:
        code: FORMAT_SPOUSE_OR_CIVIL_PARTNERS_DATE_OF_BIRTH
        message: The provided spouse or civil partner's date of birth date is invalid
    ruleDeceasedRecipient:
      description: |
        The supplied spouse or civil partner is invalid because they are deceased.
      value:
        code: RULE_DECEASED_RECIPIENT
        message: The provided spouse or civil partner is deceased
    ruleActiveMarriageAllowanceClaim:
      description: |
        The request cannot be made as there is an existing Marriage Allowance claim.
      value:
        code: RULE_ACTIVE_MARRIAGE_ALLOWANCE_CLAIM
        message: Marriage Allowance has already been transferred to a spouse or civil
          partner
    ruleIncorrectOrEmptyBody:
      description: |
        An empty or non-matching body was submitted.
      value:
        code: RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED
        message: An empty or non-matching body was submitted
    ruleInvalidRequest:
      description: |
        The request cannot be made as the current NINO supplied is invalid.
      value:
        code: RULE_INVALID_REQUEST
        message: The NINO supplied is invalid
    ruleIncorrectGovTestScenario:
      description: "The request did not match any available Sandbox data. Check that\
        \ the supplied Gov-Test-Scenario is correct for \nthis endpoint version. This\
        \ error will only be returned in the Sandbox environment.\n"
      value:
        code: RULE_INCORRECT_GOV_TEST_SCENARIO
        message: The supplied Gov-Test-Scenario is not valid
    clientOrAgentNotAuthorised:
      description: |
        The client and/or agent is not authorised. This is normally because: the client is not subscribed to MTD, the agent is not subscribed to Agent Services, or the client has not authorised the agent to act on their behalf.
      value:
        code: CLIENT_OR_AGENT_NOT_AUTHORISED
        message: The client and/or agent is not authorised
  headers:
    correlationId:
      description: |
        Unique ID for operation tracking
        String, 36 characters.
      required: true
      schema:
        type: string
        example: c75f40a6-a3df-4429-a697-471eeec46435
    deprecationHeader:
      description: |
        The deprecation date/time for this endpoint.
      required: false
      schema:
        type: string
        example: "Sun, 01 Jan 2023 23:59:59 GMT"
    sunsetHeader:
      description: |
        The earliest date/time this endpoint will become unavailable after deprecation.
      required: false
      schema:
        type: string
        example: "Sun, 02 Jul 2023 23:59:59 GMT"
    linkHeader:
      description: |
        URL of the documentation for the API.
      required: false
      schema:
        type: string
        example: https://developer.service.hmrc.gov.uk/api-documentation/docs/api/service/individuals-disclosures-api
  securitySchemes:
    User-Restricted:
      type: oauth2
      description: "HMRC supports OAuth 2.0 for authenticating [User-restricted](https://developer.service.hmrc.gov.uk/api-documentation/docs/authorisation/user-restricted-endpoints)\
        \ API requests"
      flows:
        authorizationCode:
          authorizationUrl: https://api.service.hmrc.gov.uk/oauth/authorize
          tokenUrl: https://api.service.hmrc.gov.uk/oauth/token
          refreshUrl: https://api.service.hmrc.gov.uk/oauth/refresh
          scopes:
            write:self-assessment: Grant write access
            read:self-assessment: Grant read access
